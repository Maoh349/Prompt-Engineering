# 第3章 ITエンジニア向けのプロンプトテクニック
LLMはインターネットに存在する膨大な情報を使って学習しています。その中にはGitHubのリポジトリや技術記事、ソフトウェアのマニュアルなども含まれるので、LLMはプログラミングに関する豊富な知識を持っています。
このような背景から、私たちITエンジニアはプログラマーの流儀でLLMに接することで大きな恩恵を得ることが可能です。
この章では、ITエンジニアならではの役立つテクニックを紹介します。

## 3.1 プログラマー思考
「日本語よりもコードを書く方が得意」というそんなあなたに朗報です。LLMも、下手くそな日本語よりも明快なコードの方を好みます。

### 3.1.1 疑似コード
以下は、第2章で取り上げたChain-of-Thoghtのプロンプトです（再掲）。
```
Pythonをp4nと表記することにします。
まず、Pythonという文字列を先頭の文字（P）、中間文字列（ytho）、末尾の文字（n）に分解します。
先頭の文字は小文字に変換（p）し、中間文字列は文字数（4）に変換し、末尾の文字は小文字に
変換（n）します。
変換したものを連結するとp4nとなります。
では、JavaScriptはどう表記されますか？
```

思考過程を提示することで、`JavaScript`は`j8n`と表記する、いう正しい回答が得られました。
ただ、このような文章を書くのは少々面倒くさいですよね。ITエンジニアなら、コードで書いた方が速そうです。

```
以下の疑似コードを実行してください。
---
var name = "JavaScript"
name = name[0].toLower() + name.length - 2 + name[name.length - 1].toLower()
print(name)
```

上記のプロントは、JavaScriptチックな疑似コードを示して、実行させています（実際にはString型にあるのは `toLowerCase`メソッドであり、`toLower`メソッドではありません）。
以下のような回答が返ってきます。

```
この疑似コードを順番に実行していきましょう。

1. まず、変数 `name` に "JavaScript" が代入されます。

2. 次に、`name` が以下のように変更されます：
   - `name[0].toLower()`: "JavaScript" の最初の文字 'J' を小文字にします。結果は 'j'
   - `name.length - 2`: "JavaScript" の長さ (10) から 2 を引きます。結果は 8
   - `name[name.length - 1].toLower()`: "JavaScript" の最後の文字 't' を小文字に
します（すでに小文字なので変化なし）。結果は 't'

3. これらの要素を連結します：
   'j' + 8 + 't'

4. 最終的に `name` は文字列 "j8t" になります。

5. `print(name)` で結果を出力します。

したがって、このコードの出力結果は：

j8t

となります。
```

疑似コードをステップバイステップで実行する過程を経ることで、正しい結果を得ることができました。

### 3.1.2 コード生成

疑似コードを提示するのではなく、実際に動作するコードを生成させる手もあります。

```
Pythonはp4n、Haskellはh5lのように文字列を変換するJavaScriptの関数を作ってください。
そして、その関数にJavaScriptを入力した時の結果を示してください。
```

上記のプロンプトは、PythonとHaskellの2つの例を示すこと（Few-shotプロンプティング）で精度の向上を狙っています。

```
はい、ご要望の関数を作成し、JavaScriptを入力として与えた場合の結果をお示しします。

（提示されたプログラムは誤っているため省略）

この関数は以下のように動作します：

1. 言語名の最初の文字を小文字で取得します。
2. 最後の文字を除いた中間部分の子音の数をカウントします。
3. 言語名の最後の文字を小文字で取得します。
4. これらを組み合わせて、「最初の文字 + 子音の数 + 最後の文字」の形式で結果を返します。

JavaScriptを入力として与えた場合の結果は次のようになります：

console.log(abbreviateLanguage('JavaScript')); // 'j6t'

（以下省略）
```

なんと、「子音の数をカウント」という勝手な仕様を盛り込むというミスを犯してしまっています！　このように、生成AIはいとも簡単に間違えるので、結果を鵜呑みにせず、チェックすることが大切です。
うまくいったプロンプトを以下に示しましょう。

```
任意のプログラミング言語を引数に取り、変換して返す関数を作成してください。
そして、その関数に JavaScript を入力した場合の結果を示してください。

convertLanguageName('Python') == 'p4n'
convertLanguageName('Haskell') == 'h5l'
```

回答は以下のとおりです。

```
ご要望の関数を作成し、JavaScriptの例も示します。以下がその実装です:

（提示されたコードは後述）

この関数は以下のように動作します:

1. 入力が文字列でない場合、または2文字以下の場合は、そのまま入力を返します。
2. 言語名の最初の文字を小文字にします。
3. 言語名の最後の文字を小文字にします。
4. 言語名の長さから2を引いた数（中間の文字数）を計算します。
5. これらを組み合わせて、"最初の文字 + 中間の文字数 + 最後の文字" の形式で返します。

`JavaScript` を入力した場合、結果は `'j8t'` となります。これは次のように導出されます：
- 最初の文字 'j'
- 中間の文字数 8 ('avaScrip' の長さ)
- 最後の文字 't'

関数内でコンソールに出力していますが、実際の使用では `return` 文の結果を直接利用することが
できます。

この関数は与えられた例（`Python` -> `'p4n'`、`Haskell` -> `'h5l'`）にも正しく対応
していることが確認できます。他の言語名でもテストしてみたい場合は、お知らせください。
```

提示されたコードは以下です。

``` javascript
function convertLanguageName(language) {
  if (typeof language !== 'string' || language.length <= 2) {
    return language;
  }
  
  const firstChar = language[0].toLowerCase();
  const lastChar = language[language.length - 1].toLowerCase();
  const middleLength = language.length - 2;
  
  return `${firstChar}${middleLength}${lastChar}`;
}

// JavaScriptを入力した場合の例
console.log(convertLanguageName('JavaScript')); // 出力: 'j8t'

// 追加のテストケース
console.log(convertLanguageName('Python')); // 出力: 'p4n'
console.log(convertLanguageName('Haskell')); // 出力: 'h5l'
```

いかがでしょうか。
正しい振る舞いの例をコードで提示して、それをパスするコードを実装する。そう、これは **テスト駆動開発（TDD）** ですね。LLMは当然TDDについても学習しているので、TDDっぽい指示が効果を発揮したのではないかと推測します。

実際に、確かめてみましょう。

```
Pythonはp4n、Haskellはh5lのように文字列を変換するJavaScriptの関数を作ってください。
テスト駆動開発で考えてください。
そして、その関数にJavaScriptを入力した時の結果を示してください。
```

回答は以下です。

```
はい、テスト駆動開発のアプローチを使ってこの関数を作成しましょう。
まず、テストケースを定義し、それに基づいて関数を実装していきます。

（提示されたコードは後述）

この関数とテストケースを実行すると、以下のような結果が得られます：

Input: Python, Result: p4n, Expected: p4n, PASS
Input: Haskell, Result: h5l, Expected: h5l, PASS
Input: JavaScript, Result: j8t, Expected: j8t, PASS
Input: Ruby, Result: r2y, Expected: r2y, PASS
Input: Go, Result: go, Expected: go, PASS
Input: a, Result: a, Expected: a, PASS

JavaScriptを入力した場合:
j8t

この実装では、以下のルールを適用しています：

1. 入力文字列の長さが2以下の場合、そのまま小文字に変換して返します。
2. それ以外の場合、最初の文字（小文字に変換）+ 中間の文字数 + 最後の文字（小文字に変換）を
返します。

JavaScriptを入力した場合、"j8t"という結果が得られます。これは期待通りの動作で、
最初の'J'と最後の'T'を小文字にし、中間の文字数8を挿入しています。

この関数は、さまざまな長さの入力に対して正しく動作することをテストケースで確認しています。
必要に応じて、さらにテストケースを追加したり、エッジケースを考慮したりすることもできます。
```

提示されたコードは以下です。

```
// テストケース
const testCases = [
  { input: 'Python', expected: 'p4n' },
  { input: 'Haskell', expected: 'h5l' },
  { input: 'JavaScript', expected: 'j8t' },
  { input: 'Ruby', expected: 'r2y' },
  { input: 'Go', expected: 'go' },
  { input: 'a', expected: 'a' },
];

// 文字列変換関数
function transformString(str) {
  if (str.length <= 2) return str.toLowerCase();
  return str[0].toLowerCase() + (str.length - 2) + str[str.length - 1].toLowerCase();
}

// テスト実行関数
function runTests() {
  testCases.forEach(({ input, expected }) => {
    const result = transformString(input);
    console.log(`Input: ${input}, Result: ${result}, Expected: ${expected}, ${result === expected ? 'PASS' : 'FAIL'}`);
  });
}

// テスト実行
runTests();

// JavaScriptを入力した場合の結果を表示
console.log("\nJavaScriptを入力した場合:");
console.log(transformString('JavaScript'));
```

完璧ですね！
ITエンジニア向けのマジカルフレーズ **「テスト駆動開発で考えてください」** を手に入れました。

## 3.2 構造化

プロンプトの記述にあたっては、マークダウン等の形式を用いて情報を構造化することは重要です。その理由について生成AIに聞いてみました。

```
プロンプトの構造化は、LLM（大規模言語モデル）の利用において非常に重要な役割を果たします。
以下に、構造化されたプロンプトの主な効果と利点を説明します：

1. 明確性の向上:
   - 情報が整理されているため、LLMがタスクや要求を正確に理解しやすくなります。
   - 曖昧さが減少し、モデルの解釈ミスが少なくなります。

2. 一貫性の確保:
   - 同様のタスクに対して、より一貫した回答を得られる可能性が高まります。
   - 複数回の利用でも、類似の結果を期待できます。

3. 出力の制御:
   - 特定のフォーマットや形式で回答を得たい場合、それを指定しやすくなります。
   - 不要な情報を除外し、必要な情報に焦点を当てやすくなります。

4. 複雑なタスクの実行:
   - 段階的な指示や多層的な要求を効果的に伝えることができます。
   - 複数の条件や制約を明確に設定できます。

5. コンテキストの提供:
   - 背景情報や関連データを整理して提供することで、より適切な回答を引き出せます。
   - モデルが特定のドメインや状況に適応しやすくなります。

6. エラー低減:
   - 指示が明確になるため、モデルの誤解や誤った仮定によるエラーが減少します。

7. 効率性の向上:
   - 必要な情報が整理されているため、モデルが素早く適切な回答を生成できます。
   - 追加の説明や修正が必要となる頻度が低下します。

8. 反復と改善の容易さ:
   - プロンプトの各部分を個別に調整しやすくなり、結果の最適化が容易になります。
   - A/Bテストなどの実験がしやすくなります。

9. 再利用性:
   - 構造化されたプロンプトは、類似のタスクや異なるコンテキストでも再利用しやすくなります。

10. モデルの能力の最大化:
    - モデルの特定の強みを活かすような指示を組み込みやすくなります。
    - モデルの限界を考慮した適切な指示を与えやすくなります。

プロンプトの構造化は、LLMとのより効果的なコミュニケーションを可能にし、望ましい結果を得る
確率を高めます。ただし、最適な構造は使用するモデルやタスクの性質によって異なる場合があるため、
実験と調整が重要です。
```

### 3.2.1 XMLによる構造化
さて、私たちは、情報の構造化について古来より伝わる形式を知っています。XML（eXtensible Markup Language）です。
ソフトウェアにおけるデータの格納や伝達という意味合いでは、すっかりJSONに取って代わられた感のあるXMLですが、プロンプトエンジニアリングの領域では、XML形式が利用されることもちらほら見かけます（とはいっても、スキーマ定義があるわけでも妥当性が検査されたわけでもなく、ゆるいマークアップ言語としてのXMLですが）。

LLMはXMLも学習しているので、XMLを理解することができます。確認してみましょう。

``` xml
<instruction>
  データを分析して回答してください。
  Q. 最も若いユーザーの名前と居住地は？
</instruction>
<data>
  <user name="山田">
    <address>東京都杉並区</address>
    <age>35</age>
  </user>
  <user name="鈴木">
    <address>神奈川県横浜市</address>
    <age>19</age>
  </user>
  <user name="佐藤">
    <address>千葉県市川市</address>
    <age>60</age>
  </user>
</data>
```

与えられたデータを解釈して、次のように正しい回答を出してくれました。

```
データを分析した結果、最も若いユーザーの情報は以下の通りです：

名前: 鈴木
居住地: 神奈川県横浜市
年齢: 19歳
```

もちろん、XPathで値を参照することもできます。先ほどの回答に続けて、

```
//user[@name="佐藤"]/address
```

と指定すれば、以下の回答が返されます。

```
XPath式 `//user[@name="佐藤"]/address` の結果は以下のとおりです：

千葉県市川市

この式は、XMLデータ内の「佐藤」という名前を持つユーザーの住所を指定しています。
```

「XPathなんて覚えていないよ」という方も安心してください。

```
user.ageを昇順で列挙してください。
```

のような雑な指定でも理解してくれます。

```
データ内のユーザーの年齢を昇順で列挙します：

1. 19 (鈴木)
2. 35 (山田)
3. 60 (佐藤)

この順序は、各ユーザーの`age`要素の値を小さい順に並べたものです。
括弧内の名前は参考情報として追加しました。
```

XMLでプロンプトを書くと記述量も増え冗長になるので、常に使うべきテクニックではありません。プロンプトが複雑で、他の要素への参照が多いような場合などで使うと有効でしょう。

## 3.3 メタプログラミング

メタプログラミングは、「プログラムを書くプログラム」や「プログラムを操作するプログラム」を作る技術を指します。
漫画のキャラクターが、物語の枠を超えて読者の視点でセリフを言うことを「メタ発言」などといいますが（例：「勝ったッ！第3部完！」）、メタとは抽象度や視座を高くして物事を認知することを意味します。

### 3.3.1 メタプロンプティング

メタプログラミングをプロンプトエンジニアリングに応用すると、「プロンプトを生成するプロンプト」となります。
実例を見ましょう。

```
あなたは、LLMに詳しい優秀なプロンプトエンジニアです。
# 指示
ユーザーの質問に対して的確な回答を得られるプロンプトを考えて提示してください。

# ユーザーの質問
Pythonをp4nとすると、JavaScriptは？
```

回答は次のようになりました。

```
なるほど、面白い質問ですね。ユーザーが求めているのは、「Python」を「p4n」と表現したように、
「JavaScript」を同様の方法で短縮表現することだと理解しました。
この質問に対して適切な回答を得るためのプロンプトを作成しましょう。

以下が提案するプロンプトです：

"""
あなたは言語名の短縮表現に詳しい言語学者です。以下の規則に従って質問に答えてください：

1. 「Python」が「p4n」と表現される規則を分析してください。
2. 同じ規則を「JavaScript」に適用してください。
3. 結果として得られる「JavaScript」の短縮表現を示してください。
4. この種の短縮表現の一般的なルールや、他のプログラミング言語への応用例についても簡単に
説明してください。

質問：「Python」が「p4n」と表現されるのと同じ規則で、「JavaScript」はどのように
表現されますか？
"""

このプロンプトは以下の点を考慮しています：

1. 専門家の設定：言語名の短縮表現に詳しい言語学者という設定により、回答の信頼性を高めます。

2. 規則の分析：「Python」から「p4n」への変換規則を明確にすることで、同じ規則を
「JavaScript」に適用できるようにします。

3. 具体的な指示：規則の適用と結果の提示を明確に指示することで、的確な回答を促します。

4. 追加の文脈：この種の短縮表現の一般的なルールや他の例を求めることで、回答に深みを
持たせます。

5. 明確な質問：最後に具体的な質問を示すことで、回答の焦点を明確にします。

このプロンプトを使用することで、ユーザーの質問に対する適切で詳細な回答が得られると考えます。
```

公平を期すために新しいチャットを開いて、提示されたプロンプトをそのまま貼りつけます。

```
あなたは言語名の短縮表現に詳しい言語学者です。以下の規則に従って質問に答えてください：

1. 「Python」が「p4n」と表現される規則を分析してください。
2. 同じ規則を「JavaScript」に適用してください。
3. 結果として得られる「JavaScript」の短縮表現を示してください。
4. この種の短縮表現の一般的なルールや、他のプログラミング言語への応用例についても簡単に
説明してください。

質問：「Python」が「p4n」と表現されるのと同じ規則で、「JavaScript」はどのように
表現されますか？
```

回答は次のようになりました。

```
この短縮表現の規則を分析し、JavaScriptに適用してみましょう。

1. 「Python」から「p4n」への変換規則:
   - 単語の最初の文字を残す (p)
   - 最後の文字を残す (n)
   - 中間の文字数を数字で置き換える (ytho → 4)

2. この規則を「JavaScript」に適用すると:
   - 最初の文字: J
   - 最後の文字: t
   - 中間の文字数: 8 (avaScript)

3. したがって、「JavaScript」の短縮表現は:
   J8t

4. この種の短縮表現の一般的なルールと応用例:
   - この方法は「numeronym」と呼ばれます。
   - 最初と最後の文字を保持し、中間の文字数を数字で置き換えます。
   - 長い単語や複雑な名称を簡潔に表現するのに便利です。
   - 他のプログラミング言語への応用例:
     * Ruby → R2y
     * Kotlin → K4n
     * TypeScript → T8t

この手法は技術分野で頻繁に使用され、長い単語を簡潔に表現しつつ、元の単語を推測可能な形で
保存する効果的な方法です。
```

最初の文字が大文字のままなので惜しくも不正解ですが、プロンプト自体はいい線を行っているのではないでしょうか。プロンプトの解説も勉強になりますね。

> 4. 追加の文脈：この種の短縮表現の一般的なルールや他の例を求めることで、回答に深みを持たせます。

このあたりは参考になりますし、実際の回答からも「numeronym」という豆知識を得ることができました。

うまく行かなかった原因をAIに聞いてみましょう。

```
「j8t」のように最初の文字が小文字になることを期待していました。
プロンプトとして何が悪かったのでしょうか。
```

以下とのことです。

```
ご指摘ありがとうございます。確かに、期待された結果と実際の回答に違いがありました。
プロンプトの改善点を分析してみましょう。

プロンプトの問題点：

1. 大文字・小文字の扱いに関する指示がなかった：
   「Python」が「p4n」になる例では最初の文字が小文字になっていますが、この点について
明示的な指示がありませんでした。

2. 具体例の詳細な分析を求めていなかった：
   「Python」から「p4n」への変換の全ての側面（大文字小文字の変換を含む）を詳細に分析
するよう明確に指示していませんでした。

3. 結果の検証ステップがなかった：
   得られた結果を元の例と比較して検証するステップを含めていませんでした。

改善されたプロンプト：

"""
あなたは言語名の短縮表現に詳しい言語学者です。以下の手順に従って質問に答えてください：

1. 「Python」から「p4n」への変換を以下の観点から詳細に分析してください：
   - 文字の選択（最初、最後、中間）
   - 大文字小文字の扱い
   - 数字への置換方法

2. 分析した規則を厳密に「JavaScript」に適用してください。

3. 結果として得られる「JavaScript」の短縮表現を示してください。

4. 得られた結果を「p4n」と比較し、全ての面で一致していることを確認してください。

5. この種の短縮表現の一般的なルールや、他のプログラミング言語への応用例についても簡単に
説明してください。

質問：「Python」が「p4n」と表現されるのと完全に同じ規則で、「JavaScript」はどのように
表現されますか？
"""

この改善されたプロンプトでは：

1. 変換規則の詳細な分析を求めています（大文字小文字の扱いを含む）。
2. 分析した規則の厳密な適用を指示しています。
3. 結果の検証ステップを追加しています。
4. 「完全に同じ規則で」という表現を用いて、全ての面での一致を強調しています。

これらの改善により、期待される「j8t」という結果が得られる可能性が高くなります。
プロンプトエンジニアリングにおいては、このように細部まで注意を払い、曖昧さを排除することが
重要です。
```

なるほど。

> 3.結果の検証ステップを追加しています。

は有効だと思います。新しいチャットを開始して改善後のプロンプトを貼り付けます。

```
あなたは言語名の短縮表現に詳しい言語学者です。以下の手順に従って質問に答えてください：

1. 「Python」から「p4n」への変換を以下の観点から詳細に分析してください：
   - 文字の選択（最初、最後、中間）
   - 大文字小文字の扱い
   - 数字への置換方法

2. 分析した規則を厳密に「JavaScript」に適用してください。

3. 結果として得られる「JavaScript」の短縮表現を示してください。

4. 得られた結果を「p4n」と比較し、全ての面で一致していることを確認してください。

5. この種の短縮表現の一般的なルールや、他のプログラミング言語への応用例についても簡単に
説明してください。

質問：「Python」が「p4n」と表現されるのと完全に同じ規則で、「JavaScript」はどのように
表現されますか？
```

以下のように、今度は正しい結果を得ることができました！

```
ご質問ありがとうございます。言語学者として、「Python」から「p4n」への変換を分析し、
同じ規則を「JavaScript」に適用してみましょう。

1. 「Python」から「p4n」への変換の分析:
   - 文字の選択: 最初の文字「P」と最後の文字「n」が選ばれています。
   - 大文字小文字の扱い: 最初の文字は小文字化されています。
   - 数字への置換: 中間の文字数（「ytho」の4文字）が数字「4」に置き換えられています。

2. この規則を厳密に「JavaScript」に適用すると:
   - 最初の文字「J」を選択し、小文字化します。
   - 最後の文字「t」を選択します。
   - 中間の文字数「avaScrip」（8文字）を数字に置き換えます。

3. 結果として得られる「JavaScript」の短縮表現:
   「j8t」

4. 「p4n」との比較:
   - 最初の文字: 小文字（一致）
   - 中間: 文字数を表す数字（一致）
   - 最後の文字: 元の小文字（一致）
   全ての面で一致していることが確認できます。

5. この種の短縮表現の一般的なルールと応用例:
   この短縮法は「頭文字-数字-末尾文字」形式と呼べるでしょう。一般的なルールは:
   1. 最初の文字を小文字で使用
   2. 中間の文字数を数字で表現
   3. 最後の文字をそのまま使用

   他のプログラミング言語への応用例:
   - Ruby → r2y
   - Kotlin → k4n
   - Swift → s3t

この短縮表現は、プログラミング言語名を簡潔に表現する際に便利ですが、一般的には広く使用
されているわけではありません。特定のコミュニティや文脈で使用される可能性がありますが、
公式な略称ではないことに注意が必要です。
```

## 3.4 仕組み化

プログラマーの三代美徳のひとつは怠惰（Laziness）です[1]。繰り返し作業を嫌い、作業を楽にするための仕組みを作りたがります。

### 3.4.1 共通関数

メタプロンプティングで使用したプロンプトを再掲します。

```
あなたは、LLMに詳しい優秀なプロンプトエンジニアです。
# 指示
ユーザーの質問に対して的確な回答を得られるプロンプトを考えて提示してください。

# ユーザーの質問
Pythonをp4nとすると、JavaScriptは？
```

ユーザーの質問の部分を変えて使い回すことは可能ですが、プログラマー脳が「不吉な匂い」を察知するはずです。
ユーザーの質問を引数として与える共通関数にしてしまいましょう。

```
あなたはLLMに詳しい優秀なプロンプトエンジニアです。
慎重な性格で、AIが時々起こすミスを防ぐための検証をきちんと行います。
# 指示
1. この指示を理解して記憶します
2. ユーザーに質問が何であるかを尋ねます
3. ユーザーの質問に対する的確な回答を得るためのプロンプトを考えます
4. 考えたプロンプトを表示します
5. 実際にそのプロンプトを実行して、結果（ユーザーの質問に対する回答）を表示します
```

上記のプロンプトを入力すると、AIは以下のように反応します。

```
承知しました。プロンプトエンジニアとして、慎重にAIのミスを防ぐための検証を行いながら、
ユーザーの質問に対する適切な回答を得るためのプロンプトを作成し、実行します。

それでは、ユーザーの質問について教えていただけますか？
どのようなことについて知りたいのでしょうか？
```

質問を入力します。


```
Pythonをp4nとすると、JavaScriptは？
```

質問への回答は以下のとおりです。

```
わかりました。ユーザーの質問は「Pythonをp4nとすると、JavaScriptは？」ということですね。
これは、プログラミング言語の名前を略語化する方法についての質問だと理解しました。

それでは、この質問に対する適切な回答を得るためのプロンプトを考えてみます。

プロンプト:
"""
プログラミング言語の名前を略語化する方法について質問があります。

1. "Python"が"p4n"と略されることがあります。これは、最初の文字"P"と最後の文字"n"を
残し、その間の文字数"4"を数字で表したものです。

2. この同じ方法を使って、"JavaScript"を略語化するとどうなりますか？

3. この略語化の方法の一般的なルールを簡潔に説明してください。

4. この略語化方法は一般的に使われているのでしょうか？どのような場面で使用されることが
多いのか、例を挙げて説明してください。

回答は簡潔に、かつ上記の質問に順番に答える形で提供してください。
"""

では、このプロンプトを使って回答を生成します。



プロンプトの実行結果:

1. JavaScriptを同じ方法で略語化すると "j8t" となります。

2. この略語化の一般的なルールは以下の通りです：
   - 単語の最初の文字を残す
   - 最後の文字を残す
   - 中間の文字数を数字で表す

3. この略語化方法は "numeronym" と呼ばれ、主にIT業界やオンラインコミュニティで使用される
ことがあります。ただし、一般的にはそれほど広く使われているわけではありません。

4. 使用例：
   - 長い製品名の略称（例：i18n for internationalization）
   - ユーザー名やパスワードの作成
   - プログラミングでの変数名の短縮（ただし、可読性の観点から推奨されません）
   - オンラインフォーラムやチャットでの略語として

この略語化方法は面白いものの、公式の文書や一般的なコミュニケーションでは混乱を招く可能性が
あるため、使用には注意が必要です。
```

ばっちりですね！

共通関数化したプロンプトを、毎回チャットの冒頭に記述するのは面倒なので、カスタムプロンプト化しましょう。以下はClaudeの例となりますが、ChatGPT派の方はChatGTPのカスタム指示を利用してください。

ClaudeではProject機能を用いて、custom isntrauctionsにカスタムプロンプトを記述します。

![dc6f09518ae9-20240831](https://github.com/user-attachments/assets/dbf2ab78-6e13-492a-8900-344f7505261d)

全文は以下のとおりです（精度を上げるために前に提示したプロンプトを一部修正しています）。

```
あなたはLLMに詳しい優秀なプロンプトエンジニアです。
慎重な性格で、AIが時々起こすミスを防ぐための検証をきちんと行います。
ユーザーの質問を受けたら、以下のように振る舞ってください。
1. ユーザーの質問に対する的確な回答を得るためのプロンプトを考えます
2. ユーザーの質問に曖昧な点、不明な点がある場合は回答の精度を上げるための質問をすることが
許されます
3. 考えたプロンプトを表示します
4. 深呼吸をしてプロンプトの内容を見直し、何か問題がある場合はプロンプトを考え直してください
5. 実際にプロンプトを実行して、結果（ユーザーの質問に対する回答）を表示します
6. 結果に対する検証を行い、誤りある場合やユーザーの期待に添えてない場合は、適切なステップ
からやり直してください
```

実際にチャットで質問してみます。

```
Pythonをp4nとすると、JavaScriptは？
```

回答は以下のとおりです。

```
はい、承知しました。ご質問にお答えするために、以下のようなプロセスで進めさせていただきます。

1. まず、適切なプロンプトを考えます。

2. ご質問の内容は明確ですので、追加の質問は必要ないと判断しました。

3. 考えたプロンプトを表示します：

"プログラミング言語の略称について質問があります。Pythonが'p4n'と略されることがあります。
これは'Python'の最初と最後の文字を取り、間の文字数（4文字）を数字で表したものです。
同様の方法で、JavaScriptを略すとどうなりますか？"

4. プロンプトを見直しました。内容は適切であり、問題はないと判断しました。

5. このプロンプトに基づいて回答を生成します：

JavaScriptを同様の方法で略すと、'J8t'となります。

理由：
- 'JavaScript'の最初の文字 'J'
- 中間の文字数 8文字 (avaScrip)
- 最後の文字 't'

これらを組み合わせると、'J8t'となります。

6. 回答の検証：
この回答は論理的に正しいです。Pythonが'p4n'と略される方法と同じ規則を適用しており、
JavaScriptの文字数と構造を正確に反映しています。ユーザーの質問に直接答えており、
期待に沿った回答になっていると判断します。
```

残念なことに、頭文字が先頭のまま問題が再発しています。このあたりの精度の不安定さに対しては、現状では人間によるチェックや工夫が欠かせないでしょう。将来的には、モデルの性能向上やLLMエージェントの高度化によって精度は向上するでしょう。

### 3.4.2 RAG
RAG（Retrieval-Augmented Generation）は、生成AIの性能を向上させるための技術で、質問への回答を行うにあたって、外部のデータを参照できるようにするものです。

Claudeの場合、Project knowdlgeとしてテキストファイルやPDFファイルをアップロードして、ナレッジとして生成AIに利用させることができます。今回は、本書のはじめに〜第3章の内容をテキストファイルに落としてアップロードし、ナレッジ登録しました。また、プロジェクトのカスタムプロンプトは以下のように設定します。

```
あなたはLLMに詳しい優秀なプロンプトエンジニアです。
慎重な性格で、AIが時々起こすミスを防ぐための検証をきちんと行います。
あなたはナレッジに登録されたプロンプトエンジニアリングの技術や、一般的な
プロントエンジニアリングを駆使し、問題に対して最も効果的な手法を選択して解決にあたります。

ユーザーの質問を受けたら、以下のように振る舞ってください。
1. ユーザーの質問に対する的確な回答を得るためのプロンプトを考えます
2. ユーザーの質問に曖昧な点、不明な点がある場合は回答の精度を上げるための質問をすることが
許されます
3. 考えたプロンプトを表示します
4. 深呼吸をしてプロンプトの内容を見直し、何か問題がある場合はプロンプトを考え直してください
5. 実際にプロンプトを実行して、結果（ユーザーの質問に対する回答）を表示します
6. 結果に対する検証を行い、誤りある場合やユーザーの期待に添えてない場合は、適切な
ステップからやり直してください
```

チャットを開いて同じ質問を投げます。

```
Pythonをp4nとすると、JavaScriptは？
```

得られた回答は以下です。

```
はい、承知いたしました。ご質問に対する適切なプロンプトを考え、実行していきます。

1. プロンプトの考案:
この質問に対しては、One-shotプロンプティングとChain-of-Thoughtを組み合わせたアプローチが
効果的だと考えます。また、結果の検証ステップを含めることで、AIのミスを防ぐことができます。

2. 質問の明確化:
質問の内容は明確ですので、追加の質問は不要だと判断しました。

3. 考案したプロンプト:

"""
あなたはプログラミング言語の命名規則に詳しい専門家です。
以下の手順に従って質問に答えてください：

1. 「Python」から「p4n」への変換規則を以下の観点から詳細に分析してください：
   - 文字の選択（最初、最後、中間）
   - 大文字小文字の扱い
   - 数字への置換方法

2. 分析した規則を厳密に「JavaScript」に適用し、各ステップを説明してください。

3. 結果として得られる「JavaScript」の短縮表現を示してください。

4. 得られた結果を「p4n」と比較し、全ての面で一致していることを確認してください。

質問：「Python」が「p4n」と表現されるのと完全に同じ規則で、「JavaScript」はどのように
表現されますか？
"""

4. プロンプトの見直し:
このプロンプトは、変換規則の詳細な分析を求め、その規則の厳密な適用を指示し、さらに結果の
検証ステップを含んでいます。問題ないと判断します。

5. プロンプトの実行結果:

分析と回答は以下の通りです：

1. 「Python」から「p4n」への変換規則の分析:
   - 文字の選択: 最初の文字「P」と最後の文字「n」を選択
   - 大文字小文字の扱い: 最初の文字を小文字に変換
   - 数字への置換: 中間の文字数（「ytho」の4文字）を数字「4」に置換

2. 「JavaScript」への規則の適用:
   - 最初の文字「J」を選択し、小文字「j」に変換
   - 最後の文字「t」を選択（既に小文字なので変換不要）
   - 中間の文字「avaScript」（8文字）を数字「8」に置換

3. 結果として得られる「JavaScript」の短縮表現:
   「j8t」

4. 結果の検証:
   - 最初の文字: 小文字（「p4n」と一致）
   - 中間: 文字数を表す数字（「p4n」と一致）
   - 最後の文字: 元の小文字（「p4n」と一致）
   
   全ての面で「p4n」との一致が確認できます。

したがって、「Python」が「p4n」と表現されるのと完全に同じ規則で、
「JavaScript」は「j8t」と表現されます。

6. 結果の検証:
この回答は、与えられた規則を正確に適用し、各ステップを詳細に説明しています。
最初の文字の小文字化、中間の文字数の数字への置換、最後の文字の保持という全ての要素が「p4n」の
形式と一致しています。
また、結果の検証ステップも含まれており、ユーザーの質問に対して適切かつ正確な回答となっています。
```

与えたナレッジ中に問題の答えが含まれているので、インチキ感はどうしても拭えませんが、振る舞いとしてはとても良さそうです。

公正を期すために、別の問題で試してみましょう。以下のプロンプトを使用します。

```
アルファベットのA、E、R、Sを組み合わせてできる、最も長い英単語は？
各アルファベットは何回でも使えますが、少なくとも1回は使うようにしてください。
```

比較のため、GTP-4o miniの回答は以下でした。

```
アルファベットのA、E、R、Sを使ってできる、最も長い英単語の一例は「REASSESS」ですね。
この単語は8文字で、各アルファベットが少なくとも1回は使われています。
```

続いて、Claude 3.5 Sonnetの回答です。

```
この問題に対する最長の英単語を見つけるために、以下のステップで考えてみましょう：

1. 指定されたアルファベット（A, E, R, S）をすべて少なくとも1回使用する必要があります。
2. これらの文字を複数回使用できるので、長い単語を作るチャンスがあります。
3. "-ER", "-ERS", "-NESS"などの一般的な接尾辞を考慮すると有用かもしれません。

考えられる最長の単語の一つは：

REARRANGERS

この単語の意味：
- 「再配置する人」や「再編成する人」を指します。
- "rearrange"（再配置する、再編成する）という動詞から派生しています。

単語の構成：
- R が3回
- E が2回
- A が2回
- S が1回
使用されており、すべての指定文字が少なくとも1回は含まれています。

この単語は12文字あり、指定されたアルファベットのみを使用して作ることができる非常に長い英単語の
一つです。ただし、英語には多くの単語があり、辞書によっては他にも同じ長さや少し長い単語が存在
する可能性があります。

他に考えられる長い単語としては "REASSESSERS"（再評価する人々）なども挙げられますが、
これも12文字です。

これ以上の長さの有効な英単語を見つけるのは難しいかもしれません。
もし他に思いつくものがあれば、お知らせください。
```

"REARRANGERS" は「この単語は12文字あり、指定されたアルファベットのみを使用して作ることができる非常に長い英単語の一つ」と、誤った回答をしています。（下の方に "REASSESSERS" も出てきてはいるのですが）。

最後に、RAGを利用したカスタムプロンプトの回答です。

```
ご質問ありがとうございます。アルファベットA、E、R、Sを組み合わせて最も長い英単語を
見つけるためのプロンプトを考えてみましょう。

1. プロンプトを考えます：

"""
あなたは言語学者で、特に英語の語彙に詳しい専門家です。以下の条件を満たす英単語を
探してください：

1. アルファベットA、E、R、Sのみを使用する。
2. 各アルファベットは少なくとも1回は使用する。
3. 各アルファベットは何回でも使用可能。
4. 最も長い単語を見つける。

以下の手順で回答してください：
a) 条件を満たす最長の単語を示す。
b) その単語の意味を簡潔に説明する。
c) 単語の長さ（文字数）を示す。
d) 使用した各アルファベットの出現回数を示す。
e) この単語が実際に使用される文脈や場面の例を挙げる。
f) 同じ条件で2番目に長い単語があれば、それも示す。

注意：実在する英単語のみを対象とし、造語や固有名詞は除外してください。
一般的な英語辞書に掲載されている単語を使用してください。
"""

3. プロンプトの内容を確認します。

4. プロンプトの内容を見直しました。条件と手順が明確に示されており、適切だと判断します。

5. このプロンプトを実行して、結果を表示します：

###
a) 条件を満たす最長の単語は "REASSESSERS" です。

b) "REASSESSERS" は「再評価する人々」という意味で、"reassess"（再評価する）という動詞の
複数形の名詞です。

c) この単語の長さは11文字です。

d) 各アルファベットの出現回数：
   A: 1回
   E: 2回
   R: 2回
   S: 6回

e) この単語が使用される文脈の例：
   "The company hired external reassessers to evaluate the effectiveness of
 their new policies."
   （会社は新しい方針の有効性を評価するために、外部の再評価者を雇いました。）

f) 同じ条件で2番目に長い単語は "REASSESSES" （10文字）で、"reassess"（再評価する）の
三人称単数現在形です。
###

6. 結果の検証：
この回答は質問の条件を満たしています。"REASSESSERS" は実在の英単語で、指定された
アルファベット（A、E、R、S）のみを使用し、各文字を少なくとも1回は使っています。
また、11文字という長さは、与えられた条件下で最長である可能性が高いです。

ただし、より長い単語が存在する可能性も完全には排除できません。英語には非常に多くの単語があり
、特に専門用語や稀な単語まで含めると、見落としがある可能性があります。

そのため、ユーザーに確認させていただきます：この回答で十分ですか、それともさらに専門的な
辞書や語彙データベースを用いて、より長い単語がないか確認する必要がありますか？
```

とても良い回答が得られました。

## 3.5 まとめ
この章では、ITエンジニア向けのプロンプトテクニックを紹介しました。

- 疑似コード
- コード生成
- XMLによる構造化
- メタプロンプティング
- 共通関数
- RAG

基礎技術を学んだら手を動かして理解を深めて、状況に応じてそれらを組み合わせてより複雑な問題解決に応用する、というのはプログラミングそのものです。
ITエンジニアらしくLLMを使いこなしてみませんか？
